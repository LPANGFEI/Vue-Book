{"remainingRequest":"C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\src\\views\\BookDetail.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\src\\views\\BookDetail.vue","mtime":1567683623634},{"path":"C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\LPANGFEI\\Desktop\\Vue\\vue-book\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es7.symbol.async-iterator\";\nimport \"core-js/modules/es6.symbol\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.find\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\LPANGFEI\\\\Desktop\\\\Vue\\\\vue-book\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"C:\\\\Users\\\\LPANGFEI\\\\Desktop\\\\Vue\\\\vue-book\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport BScroll from \"better-scroll\";\nimport { setTimeout } from \"timers\";\nimport BookBrief from \"../components/BookBrief\";\nimport { mapState, maoGeyyets, mapGetters } from \"vuex\";\nimport { ADD_BOOK, REMOVE_BOOK, ADD_READ } from \"../store/mutation-types\";\nexport default {\n  name: \"BookDetail\",\n  data: function data() {\n    return {\n      isLoading: true,\n      bScroll: null,\n      bookScroll: null,\n      detail: {},\n      active: false,\n      fuzzys: [],\n      chapters: [],\n      isJoin: false,\n      index: 0\n    };\n  },\n  computed: _objectSpread({\n    msg: function msg() {\n      return this.isJoin ? \"撤出书架\" : \"加入书架\";\n    }\n  }, mapGetters([\"getBookShelf\", \"getReading\"])),\n  components: {\n    BookBrief: BookBrief\n  },\n  methods: {\n    // 小说详情\n    getBookDetail: function () {\n      var _getBookDetail = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(id) {\n        var _this = this;\n\n        var res;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.$http(\"/book/\" + id);\n\n              case 2:\n                res = _context.sent;\n                res = res.data;\n                this.detail = res;\n                this.$nextTick(function () {\n                  _this.initLoading();\n\n                  _this.initBookBScroll();\n                });\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function getBookDetail(_x) {\n        return _getBookDetail.apply(this, arguments);\n      }\n\n      return getBookDetail;\n    }(),\n    // 模糊搜索\n    getFuzzySearch: function () {\n      var _getFuzzySearch = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(id) {\n        var _this2 = this;\n\n        var res;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.$http(\"/book/fuzzy-search?query=\" + id);\n\n              case 2:\n                res = _context2.sent;\n                res = res.data;\n                this.fuzzys = res.books;\n                this.$nextTick(function () {\n                  _this2.initLoading();\n\n                  _this2.initBookBScroll();\n                });\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getFuzzySearch(_x2) {\n        return _getFuzzySearch.apply(this, arguments);\n      }\n\n      return getFuzzySearch;\n    }(),\n    // 获取小说内容\n    initLoading: function initLoading() {\n      var _this3 = this;\n\n      setTimeout(function () {\n        _this3.isLoading = false;\n      }, 1000);\n    },\n    initBScroll: function initBScroll() {\n      if (this.bScroll) {\n        this.bScroll.refresh();\n      } else {\n        this.bScroll = new BScroll(this.$refs.wrapper, {\n          probeType: 3,\n          click: true\n        });\n      }\n    },\n    initBookBScroll: function initBookBScroll() {\n      var offsetWidth = this.fuzzys.length * 80 - 20;\n      this.$refs.bookUl.style.width = offsetWidth + \"px\";\n\n      if (this.bookScroll) {\n        this.bookScroll.refresh();\n      } else {\n        this.bookScroll = new BScroll(this.$refs.interest, {\n          scrollX: true,\n          probeType: 3\n        });\n      }\n    },\n    showText: function showText() {\n      this.active = !this.active;\n    },\n    goToDetail: function goToDetail(item) {\n      console.log(item.title, item._id);\n      this.$router.push({\n        path: \"/bookdetail\",\n        query: {\n          title: item.title,\n          id: item._id\n        }\n      });\n    },\n    goToBookMore: function goToBookMore(title) {\n      this.$router.push({\n        path: \"/bookmore\",\n        query: {\n          title: title,\n          type: \"sort\"\n        }\n      });\n    },\n    // 开始阅读\n    beginRead: function beginRead(item) {\n      this.$router.push({\n        path: \"/reading\",\n        query: {\n          id: item._id,\n          title: item.title // view: \"chapters\"\n\n        }\n      });\n      this.read(item._id);\n    },\n    // 判断是否阅读过\n    read: function read(id) {\n      var read = this.getReading.find(function (read) {\n        return read.id === id;\n      });\n\n      if (read === undefined) {\n        this.$store.commit(ADD_READ, {\n          id: id,\n          index: 0\n        });\n      } else {\n        this.$store.commit(ADD_READ, read);\n      }\n    },\n    // 加入撤出书架\n    joinBookShelf: function joinBookShelf(item) {\n      this.isJoin = !this.isJoin;\n\n      if (this.isJoin) {\n        // 这个才是加入书架\n        this.$store.commit(ADD_BOOK, item);\n      } else {\n        // 这个才是撤出书架\n        this.$store.commit(REMOVE_BOOK, item);\n      }\n    },\n    // 跳转到书籍目录\n    goToCatalog: function goToCatalog(item) {\n      this.$router.push({\n        path: \"/catalog\",\n        query: {\n          id: item._id,\n          title: item.title\n        }\n      });\n    }\n  },\n  created: function created() {\n    var _this4 = this;\n\n    var _this$$route$query = this.$route.query,\n        title = _this$$route$query.title,\n        id = _this$$route$query.id;\n    this.title = title;\n    this.getBookDetail(id);\n    this.getFuzzySearch(title);\n    this.$nextTick(function () {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = _this4.getBookShelf[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var i = _step.value;\n\n          if (i._id === id) {\n            _this4.isJoin = true;\n            _this4.$refs.join.innerText = \"撤出书架\";\n          }\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    });\n  },\n  mounted: function mounted() {\n    this.initBScroll();\n  },\n  beforeDestroy: function beforeDestroy() {\n    this.bScroll.destroy();\n    this.bookScroll.destroy();\n    this.bScroll = null;\n    this.bookScroll = null;\n  }\n};",{"version":3,"sources":["BookDetail.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n    <section class=\"book-detail\">\r\n        <Spin v-show=\"isLoading\" />\r\n        <BookHeader title=\"书籍详情\" />\r\n        <div class=\"wrapper\" ref=\"wrapper\">\r\n            <div class=\"container\">\r\n                <!-- 书籍 -->\r\n                <BookBrief v-if=\"detail\" :datas=\"detail\" :id=\"$route.query.id\" />\r\n                <!-- 按钮 -->\r\n                <div class=\"btn\">\r\n                    <button\r\n                        :class=\"['join',{isJoin}]\"\r\n                        @click=\"joinBookShelf(detail)\"\r\n                        ref=\"join\"\r\n                    >{{msg}}</button>\r\n                    <button class=\"read\" @click=\"beginRead(detail)\">开始阅读</button>\r\n                </div>\r\n                <!-- 人气+留存 -->\r\n                <div class=\"data\">\r\n                    <div class=\"follower\">\r\n                        <p>追书总人气</p>\r\n                        <p class=\"num\">{{detail.totalFollower}}</p>\r\n                    </div>\r\n                    <div class=\"retention\">\r\n                        <p>读者保留率</p>\r\n                        <p class=\"num\">{{detail.retentionRatio}}%</p>\r\n                    </div>\r\n                    <div class=\"serialize\">\r\n                        <p>日更新字数/天</p>\r\n                        <p class=\"num\">{{detail.serializeWordCount}}</p>\r\n                    </div>\r\n                </div>\r\n                <!-- 简介 -->\r\n                <div class=\"content\" @click=\"showText\">\r\n                    <div :class=\"['text',{active}]\">\r\n                        <p>{{detail.longIntro}}</p>\r\n                    </div>\r\n                    <span :class=\"['icon',{active}]\"></span>\r\n                </div>\r\n                <!-- 分类 -->\r\n                <div class=\"cate\">\r\n                    <span class=\"tag\">分类</span>\r\n                    <span\r\n                        v-if=\"detail.majorCate\"\r\n                        @click=\"goToBookMore(detail.majorCate)\"\r\n                    >{{detail.majorCate}}</span>\r\n                    <span\r\n                        v-if=\"detail.majorCateV2\"\r\n                        @click=\"goToBookMore(detail.majorCateV2)\"\r\n                    >{{detail.majorCateV2}}</span>\r\n                    <span\r\n                        v-if=\"detail.minorCate\"\r\n                        @click=\"goToBookMore(detail.minorCate)\"\r\n                    >{{detail.minorCate}}</span>\r\n                    <span\r\n                        v-if=\"detail.minorCateV2\"\r\n                        @click=\"goToBookMore(detail.minorCateV2)\"\r\n                    >{{detail.minorCateV2}}</span>\r\n                </div>\r\n                <!-- 目录 -->\r\n                <div class=\"catalog\" @click=\"goToCatalog(detail)\">\r\n                    <span class=\"num\">目录</span>\r\n                    <span class=\"text\">{{detail.lastChapter}}</span>\r\n                    <span class=\"icon\"></span>\r\n                </div>\r\n                <!-- 可能感兴趣 -->\r\n                <div class=\"interest\">\r\n                    <h1 class=\"text\">你可能感兴趣</h1>\r\n                    <div class=\"pic\" ref=\"interest\" v-if=\"detail\">\r\n                        <ul ref=\"bookUl\">\r\n                            <li\r\n                                class=\"pic-li\"\r\n                                v-for=\"fuzzy in fuzzys\"\r\n                                :key=\"fuzzy._id\"\r\n                                @click=\"goToDetail(fuzzy)\"\r\n                            >\r\n                                <img v-lazy=\"'//statics.zhuishushenqi.com'+fuzzy.cover\" alt />\r\n                                <p class=\"name\">{{fuzzy.title}}</p>\r\n                            </li>\r\n                        </ul>\r\n                        <div class=\"blank\"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </section>\r\n</template>\r\n\r\n<script>\r\nimport BScroll from \"better-scroll\";\r\nimport { setTimeout } from \"timers\";\r\nimport BookBrief from \"../components/BookBrief\";\r\nimport { mapState, maoGeyyets, mapGetters } from \"vuex\";\r\nimport { ADD_BOOK, REMOVE_BOOK, ADD_READ } from \"../store/mutation-types\";\r\n\r\nexport default {\r\n    name: \"BookDetail\",\r\n    data: () => ({\r\n        isLoading: true,\r\n        bScroll: null,\r\n        bookScroll: null,\r\n        detail: {},\r\n        active: false,\r\n        fuzzys: [],\r\n        chapters: [],\r\n        isJoin: false,\r\n        index: 0\r\n    }),\r\n    computed: {\r\n        msg() {\r\n            return this.isJoin ? \"撤出书架\" : \"加入书架\";\r\n        },\r\n        // ...mapState([\"bookShelf\"])\r\n        ...mapGetters([\"getBookShelf\", \"getReading\"])\r\n    },\r\n    components: {\r\n        BookBrief\r\n    },\r\n    methods: {\r\n        // 小说详情\r\n        async getBookDetail(id) {\r\n            let res = await this.$http(\"/book/\" + id);\r\n            res = res.data;\r\n            this.detail = res;\r\n            this.$nextTick(() => {\r\n                this.initLoading();\r\n                this.initBookBScroll();\r\n            });\r\n        },\r\n        // 模糊搜索\r\n        async getFuzzySearch(id) {\r\n            let res = await this.$http(\"/book/fuzzy-search?query=\" + id);\r\n            res = res.data;\r\n            this.fuzzys = res.books;\r\n            this.$nextTick(() => {\r\n                this.initLoading();\r\n                this.initBookBScroll();\r\n            });\r\n        },\r\n        // 获取小说内容\r\n        initLoading() {\r\n            setTimeout(() => {\r\n                this.isLoading = false;\r\n            }, 1000);\r\n        },\r\n        initBScroll() {\r\n            if (this.bScroll) {\r\n                this.bScroll.refresh();\r\n            } else {\r\n                this.bScroll = new BScroll(this.$refs.wrapper, {\r\n                    probeType: 3,\r\n                    click: true\r\n                });\r\n            }\r\n        },\r\n        initBookBScroll() {\r\n            let offsetWidth = this.fuzzys.length * 80 - 20;\r\n            this.$refs.bookUl.style.width = offsetWidth + \"px\";\r\n            if (this.bookScroll) {\r\n                this.bookScroll.refresh();\r\n            } else {\r\n                this.bookScroll = new BScroll(this.$refs.interest, {\r\n                    scrollX: true,\r\n                    probeType: 3\r\n                });\r\n            }\r\n        },\r\n        showText() {\r\n            this.active = !this.active;\r\n        },\r\n        goToDetail(item) {\r\n            console.log(item.title, item._id);\r\n            this.$router.push({\r\n                path: \"/bookdetail\",\r\n                query: {\r\n                    title: item.title,\r\n                    id: item._id\r\n                }\r\n            });\r\n        },\r\n        goToBookMore(title) {\r\n            this.$router.push({\r\n                path: \"/bookmore\",\r\n                query: {\r\n                    title,\r\n                    type: \"sort\"\r\n                }\r\n            });\r\n        },\r\n        // 开始阅读\r\n        beginRead(item) {\r\n            this.$router.push({\r\n                path: \"/reading\",\r\n                query: {\r\n                    id: item._id,\r\n                    title: item.title\r\n                    // view: \"chapters\"\r\n                }\r\n            });\r\n            this.read(item._id);\r\n        },\r\n        // 判断是否阅读过\r\n        read(id) {\r\n            let read = this.getReading.find(read => read.id === id);\r\n            if (read === undefined) {\r\n                this.$store.commit(ADD_READ, {\r\n                    id,\r\n                    index: 0\r\n                });\r\n            } else {\r\n                this.$store.commit(ADD_READ, read);\r\n            }\r\n        },\r\n        // 加入撤出书架\r\n        joinBookShelf(item) {\r\n            this.isJoin = !this.isJoin;\r\n            if (this.isJoin) {\r\n                // 这个才是加入书架\r\n                this.$store.commit(ADD_BOOK, item);\r\n            } else {\r\n                // 这个才是撤出书架\r\n                this.$store.commit(REMOVE_BOOK, item);\r\n            }\r\n        },\r\n        // 跳转到书籍目录\r\n        goToCatalog(item) {\r\n            this.$router.push({\r\n                path: \"/catalog\",\r\n                query: {\r\n                    id: item._id,\r\n                    title: item.title\r\n                }\r\n            });\r\n        }\r\n    },\r\n    created() {\r\n        let { title, id } = this.$route.query;\r\n        this.title = title;\r\n        this.getBookDetail(id);\r\n        this.getFuzzySearch(title);\r\n        this.$nextTick(() => {\r\n            for (let i of this.getBookShelf) {\r\n                if (i._id === id) {\r\n                    this.isJoin = true;\r\n                    this.$refs.join.innerText = \"撤出书架\";\r\n                }\r\n            }\r\n        });\r\n    },\r\n    mounted() {\r\n        this.initBScroll();\r\n    },\r\n    beforeDestroy() {\r\n        this.bScroll.destroy();\r\n        this.bookScroll.destroy();\r\n        this.bScroll = null;\r\n        this.bookScroll = null;\r\n    }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.book-detail {\r\n    width: 100%;\r\n    .wrapper {\r\n        width: 100%;\r\n        height: 100vh;\r\n        overflow: hidden;\r\n        .container {\r\n            width: 100%;\r\n            padding: 0 10px;\r\n        }\r\n    }\r\n    .blank {\r\n        height: 20px !important;\r\n    }\r\n}\r\n.btn {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    width: 100%;\r\n    height: 60px;\r\n    margin-top: 10px;\r\n    padding-bottom: 20px;\r\n    border-bottom: 1px solid #eee;\r\n    button {\r\n        width: 45%;\r\n        height: 40px;\r\n        font-size: 20px;\r\n        outline: none;\r\n        border-width: 1px;\r\n        border-style: solid;\r\n        border-color: #b93321;\r\n        border-radius: 2px;\r\n        background-color: #fff;\r\n    }\r\n    .join {\r\n        color: #b93321;\r\n        &.isJoin {\r\n            border: none;\r\n            color: #fff;\r\n            background-color: #999;\r\n        }\r\n    }\r\n    .read {\r\n        color: #fff;\r\n        background-color: #b93321;\r\n    }\r\n}\r\n.data {\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n    width: 100%;\r\n    height: 80px;\r\n    padding: 20px 0;\r\n    border-bottom: 1px solid #eee;\r\n    div {\r\n        width: 33.33%;\r\n        font-size: 12px;\r\n        line-height: 20px;\r\n        text-align: center;\r\n        color: #999;\r\n        .num {\r\n            margin-top: 4px;\r\n            font-size: 16px;\r\n            color: #222;\r\n        }\r\n    }\r\n}\r\n.content {\r\n    position: relative;\r\n    width: 100%;\r\n    padding: 20px 0;\r\n    border-bottom: 1px solid #eee;\r\n    .text {\r\n        -webkit-line-clamp: 4;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        display: -webkit-box;\r\n        -webkit-box-orient: vertical;\r\n        word-wrap: break-word;\r\n        white-space: normal;\r\n        font-size: 13px;\r\n        line-height: 20px;\r\n        text-indent: 2em;\r\n        color: #333;\r\n        &.active {\r\n            -webkit-line-clamp: 100;\r\n            overflow: inherit;\r\n        }\r\n    }\r\n    .icon {\r\n        position: absolute;\r\n        bottom: 0px;\r\n        right: 0;\r\n        z-index: 3;\r\n        width: 20px;\r\n        height: 20px;\r\n        background-position: 50%;\r\n        background-repeat: no-repeat;\r\n        background-size: 12px auto;\r\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAANCAQAAAAZZWZbAAAAkElEQVR4AY2RtQEDMQxFX+D4RsgA6cN4XGr/cQJyEzD9yvCeZIAVWxbEJKNhDQ3CiUUE3iE0UNAjnFniS674nVQnqlw8iiHuJN/+hQRbzBluJP8tryQWfLAXy2j/61Aa3H7clOb7pJSMFtyipABUip/9T55yR2hIqZnifihRpVX8aMGtyg1BODAnMglHdnb8CYQbEwGgBxiKAAAAAElFTkSuQmCC);\r\n        &.active {\r\n            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAANCAQAAAAZZWZbAAAAlElEQVR4AY2ShQ1CMRBA33efgSgD4B/3aPdfhwsO1Vdvz1OMZCwYExNIzhYlbUocJr5DybjKPPOrFHfxLRndXWVO7Bbfo9iQIdBykdOCBAslBxRrMgS/yl2cFRnfNHeVnkQXP97FU/6pOcvL8vel4nS/NEdbc/oxdr/Q3eoGV2Qvl3piusrxWRCPuJ4lg+BfU7JneAOq9xL9utncPAAAAABJRU5ErkJggg==);\r\n        }\r\n    }\r\n}\r\n.cate {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    width: 100%;\r\n    height: 60px;\r\n    line-height: 20px;\r\n    padding: 20px 0;\r\n    border-bottom: 1px solid #eee;\r\n    span {\r\n        // flex: 1;\r\n        display: inline-block;\r\n        font-size: 12px;\r\n        color: #999;\r\n    }\r\n    .tag {\r\n        font-size: 14px;\r\n        color: #333;\r\n    }\r\n}\r\n.catalog {\r\n    position: relative;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    width: 100%;\r\n    height: 60px;\r\n    line-height: 20px;\r\n    padding: 20px 0;\r\n    border-bottom: 1px solid #eee;\r\n    font-size: 14px;\r\n    color: #333;\r\n    .num {\r\n        flex: 0 0 60px;\r\n        width: 60px;\r\n    }\r\n    .text {\r\n        flex: 1;\r\n        white-space: nowrap;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        font-size: 12px;\r\n        text-align: right;\r\n        color: #999;\r\n    }\r\n    .icon {\r\n        flex: 0 0 20px;\r\n        width: 20px;\r\n        height: 12px;\r\n        background-position: 50%;\r\n        background-repeat: no-repeat;\r\n        background-size: 12px auto;\r\n        background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAANCAQAAAAZZWZbAAAAkElEQVR4AY2RtQEDMQxFX+D4RsgA6cN4XGr/cQJyEzD9yvCeZIAVWxbEJKNhDQ3CiUUE3iE0UNAjnFniS674nVQnqlw8iiHuJN/+hQRbzBluJP8tryQWfLAXy2j/61Aa3H7clOb7pJSMFtyipABUip/9T55yR2hIqZnifihRpVX8aMGtyg1BODAnMglHdnb8CYQbEwGgBxiKAAAAAElFTkSuQmCC);\r\n        transform: rotate(-90deg);\r\n    }\r\n}\r\n.interest {\r\n    width: 100%;\r\n    padding: 20px 0;\r\n    .text {\r\n        position: relative;\r\n        box-sizing: border-box;\r\n        padding-left: 10px;\r\n        margin-bottom: 10px;\r\n        line-height: 30px;\r\n        font-size: 18px;\r\n        font-weight: 500;\r\n        color: #000;\r\n        &::after {\r\n            content: \"\";\r\n            position: absolute;\r\n            left: 4px;\r\n            top: 50%;\r\n            width: 2px;\r\n            height: 20px;\r\n            background-color: #d43c33;\r\n            transform: translateY(-50%);\r\n        }\r\n    }\r\n    .pic {\r\n        width: 100%;\r\n        overflow: hidden;\r\n        ul {\r\n            white-space: nowrap;\r\n            .pic-li {\r\n                display: inline-block;\r\n                margin-right: 20px;\r\n                width: 60px;\r\n                height: 80px;\r\n\r\n                &:last-child {\r\n                    margin-right: 0;\r\n                }\r\n                img {\r\n                    display: block;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                }\r\n                p {\r\n                    white-space: nowrap;\r\n                    text-overflow: ellipsis;\r\n                    overflow: hidden;\r\n                    font-size: 10px;\r\n                    line-height: 30px;\r\n                    color: #333;\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views"}]}